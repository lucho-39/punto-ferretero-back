{% extends "base.html" %}

{% block titulo %}
Subir Productos
{% endblock titulo %}

{% block contenido %}

<h2 class="color5">Importar productos desde archivo Excel</h2>
<div class="articulos unaColumna">
    <article>
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div class="mensajes">
            {% for category, message in messages %}
            <p class="{{ category }}">{{ message }}</p>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}

        {% if productos_duplicados %}
        <div class="duplicados">
            <h3 class="color5">Productos Duplicados Detectados</h3>
            <p>Los siguientes productos ya existen en la base de datos y no fueron importados:</p>
            <table>
                <thead>
                    <tr>
                        <td class="bold">Fila Excel</td>
                        <td class="bold">Artículo</td>
                        <td class="bold">Código</td>
                        <td class="bold">Descripción</td>
                        <td class="bold">Proveedor</td>
                    </tr>
                </thead>
                <tbody>
                    {% for duplicado in productos_duplicados %}
                    <tr>
                        <td>{{ duplicado.fila }}</td>
                        <td>{{ duplicado.art }}</td>
                        <td>{{ duplicado.cod }}</td>
                        <td>{{ duplicado.desc }}</td>
                        <td>{{ duplicado.proveedor }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <br>
        {% endif %}

        {% if productos_importados %}
        <div class="exito">
            <h3 class="color5">✅ Importación Exitosa</h3>
            <p>Se importaron <strong>{{ productos_importados }}</strong> productos correctamente.</p>
        </div>
        <br>
        {% endif %}

        <p>Selecciona un archivo Excel (.xlsx o .xls) con los datos de los productos a importar.</p>
        <p><strong>Columnas esperadas:</strong></p>
        <ul>
            <li><strong>Proveedor</strong> (o proveedor, prov): Código del proveedor</li><br>
            <li><strong>Artículo</strong> (o Articulo, artículo, articulo, art): Código del artículo (opcional)</li><br>
            <li><strong>Código</strong> (o Codigo, código, codigo, cod): Código del producto (opcional)</li><br>
            <li><strong>Categoría</strong> (o Categoria, Cat, cat): Categoría del producto</li>
            <li>Valores posibles de ejemplo: por Unidad, por Metro, Bazar, Electricidad, Herramientas, ... (sólo uno)</li><br>
            <li><strong>Imagen</strong> (o imagen, Img, img): URL de imagen del producto (opcional)</li><br>
            <li><strong>Descripción</strong> (o Descripcion, descripción, descripcion, desc): Descripción del producto</li>
        </ul>

        <form method="POST" enctype="multipart/form-data">
            <input type="file" name="file" accept=".xlsx,.xls" required>
            <input type="submit" value="Subir Archivo">
        </form>
    </article>
    <div class="crear">
        <a href="{{ url_for('productos') }}" class="menuSPA color2">Volver a Productos</a>
    </div>
</div>

{% endblock contenido %}